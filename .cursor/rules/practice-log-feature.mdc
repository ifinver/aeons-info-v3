---
description: 炼功日志功能的实现细节和使用指南
---

# 炼功日志功能指南

## 功能概述
炼功日志是从"炼功计时器"演进而来的新功能，提供了完整的日志记录和管理系统。

## 前端实现

### 主要文件
- **界面文件**: [src/client/practice-timer.js](mdc:src/client/practice-timer.js)
- **路由配置**: [src/client/app.js](mdc:src/client/app.js)

### 核心功能
1. **时间轴展示**: 左侧垂直时间轴，右侧日志内容
2. **Markdown 编辑器**: 支持实时预览的日志编辑
3. **CRUD 操作**: 创建、读取、更新、删除日志
4. **响应式设计**: 移动端和桌面端适配

### 关键 CSS 类
- `.practice-log-section` - 日志板块容器
- `.log-timeline` - 时间轴容器
- `.timeline-item` - 单个日志项
- `.markdown-editor` - Markdown 编辑器
- `.log-preview` - 实时预览区域

## 后端实现

### API 端点
- `GET /api/kv/practice-logs` - 获取所有日志
- `POST /api/kv/practice-logs` - 创建新日志
- `GET /api/kv/practice-logs/:id` - 获取单个日志
- `PUT /api/kv/practice-logs/:id` - 更新日志
- `DELETE /api/kv/practice-logs/:id` - 删除日志

### 数据结构
```typescript
interface PracticeLog {
  id: string;
  date: string;
  content: string;
  timestamp: string;
  lastModified?: string;
}
```

### 缓存策略
- 内存缓存提高读取性能
- 写操作同时更新缓存和 KV 存储
- 用户隔离的缓存管理

## 安全特性
- 用户认证验证
- CSRF 保护
- 输入验证和清理
- 内容长度限制（50KB）

## 使用流程
1. 用户访问炼功日志页面
2. 查看现有日志的时间轴展示
3. 点击绿色 + 按钮添加新日志
4. 在 Markdown 编辑器中输入内容
5. 实时预览编辑效果
6. 保存日志到 KV 存储
7. 支持后续编辑和删除操作